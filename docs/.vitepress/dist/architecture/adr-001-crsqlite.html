<!DOCTYPE html>
<html lang="de-DE" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ADR‑001: CR‑SQLite (Local‑First + CRDT) | FMB Log</title>
    <meta name="description" content="Benutzer- und Administratorhandbuch">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BvuTMFC_.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Cb9TqIXL.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.YYaW4H78.js">
    <link rel="modulepreload" href="/assets/chunks/framework.dvv-DFtf.js">
    <link rel="modulepreload" href="/assets/architecture_adr-001-crsqlite.md.DQ6cnhaB.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-55287221><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d3d12773></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-d3d12773>Skip to content</a><!--]--><!----><header class="VPNav" data-v-55287221 data-v-4fb44f18><div class="VPNavBar" data-v-4fb44f18 data-v-a9732564><div class="wrapper" data-v-a9732564><div class="container" data-v-a9732564><div class="title" data-v-a9732564><div class="VPNavBarTitle has-sidebar" data-v-a9732564 data-v-3035eb9f><a class="title" href="/" data-v-3035eb9f><!--[--><!--]--><!----><span data-v-3035eb9f>FMB Log</span><!--[--><!--]--></a></div></div><div class="content" data-v-a9732564><div class="content-body" data-v-a9732564><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a9732564><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a9732564 data-v-19c261b3><span id="main-nav-aria-label" class="visually-hidden" data-v-19c261b3> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/user-guide/" tabindex="0" data-v-19c261b3 data-v-f8fd2335><!--[--><span data-v-f8fd2335>User Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/admin-guide/" tabindex="0" data-v-19c261b3 data-v-f8fd2335><!--[--><span data-v-f8fd2335>Admin Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/reference/" tabindex="0" data-v-19c261b3 data-v-f8fd2335><!--[--><span data-v-f8fd2335>Referenz</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/architecture/" tabindex="0" data-v-19c261b3 data-v-f8fd2335><!--[--><span data-v-f8fd2335>Architektur</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a9732564 data-v-5759eef3><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-5759eef3 data-v-535e7efe data-v-e1f0101b><span class="check" data-v-e1f0101b><span class="icon" data-v-e1f0101b><!--[--><span class="vpi-sun sun" data-v-535e7efe></span><span class="vpi-moon moon" data-v-535e7efe></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a9732564 data-v-cc3370b0 data-v-190fa786><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-190fa786><span class="vpi-more-horizontal icon" data-v-190fa786></span></button><div class="menu" data-v-190fa786><div class="VPMenu" data-v-190fa786 data-v-1f941dc4><!----><!--[--><!--[--><!----><div class="group" data-v-cc3370b0><div class="item appearance" data-v-cc3370b0><p class="label" data-v-cc3370b0>Appearance</p><div class="appearance-action" data-v-cc3370b0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-cc3370b0 data-v-535e7efe data-v-e1f0101b><span class="check" data-v-e1f0101b><span class="icon" data-v-e1f0101b><!--[--><span class="vpi-sun sun" data-v-535e7efe></span><span class="vpi-moon moon" data-v-535e7efe></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a9732564 data-v-80e37428><span class="container" data-v-80e37428><span class="top" data-v-80e37428></span><span class="middle" data-v-80e37428></span><span class="bottom" data-v-80e37428></span></span></button></div></div></div></div><div class="divider" data-v-a9732564><div class="divider-line" data-v-a9732564></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-55287221 data-v-92ec37b5><div class="container" data-v-92ec37b5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92ec37b5><span class="vpi-align-left menu-icon" data-v-92ec37b5></span><span class="menu-text" data-v-92ec37b5>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-92ec37b5 data-v-c82552ea><button data-v-c82552ea>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-55287221 data-v-0a17662b><div class="curtain" data-v-0a17662b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-0a17662b><span class="visually-hidden" id="sidebar-aria-label" data-v-0a17662b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-4209d84a><section class="VPSidebarItem level-0 has-active" data-v-4209d84a data-v-3db63f30><div class="item" role="button" tabindex="0" data-v-3db63f30><div class="indicator" data-v-3db63f30></div><h2 class="text" data-v-3db63f30>Architektur</h2><!----></div><div class="items" data-v-3db63f30><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3db63f30 data-v-3db63f30><div class="item" data-v-3db63f30><div class="indicator" data-v-3db63f30></div><a class="VPLink link link" href="/architecture/" data-v-3db63f30><!--[--><p class="text" data-v-3db63f30>Überblick</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3db63f30 data-v-3db63f30><div class="item" data-v-3db63f30><div class="indicator" data-v-3db63f30></div><a class="VPLink link link" href="/architecture/adr-001-crsqlite.html" data-v-3db63f30><!--[--><p class="text" data-v-3db63f30>ADR‑001: CR‑SQLite</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3db63f30 data-v-3db63f30><div class="item" data-v-3db63f30><div class="indicator" data-v-3db63f30></div><a class="VPLink link link" href="/architecture/adr-002-integrity-signing.html" data-v-3db63f30><!--[--><p class="text" data-v-3db63f30>ADR‑002: Integrität & Signaturen</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3db63f30 data-v-3db63f30><div class="item" data-v-3db63f30><div class="indicator" data-v-3db63f30></div><a class="VPLink link link" href="/architecture/adr-003-protocol-packs.html" data-v-3db63f30><!--[--><p class="text" data-v-3db63f30>ADR‑003: Protokoll‑Packfiles</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-55287221 data-v-effb0f7a><div class="VPDoc has-sidebar has-aside" data-v-effb0f7a data-v-761d60a5><!--[--><!--]--><div class="container" data-v-761d60a5><div class="aside" data-v-761d60a5><div class="aside-curtain" data-v-761d60a5></div><div class="aside-container" data-v-761d60a5><div class="aside-content" data-v-761d60a5><div class="VPDocAside" data-v-761d60a5 data-v-a3771c4a><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-a3771c4a data-v-05b516a5><div class="content" data-v-05b516a5><div class="outline-marker" data-v-05b516a5></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-05b516a5>On this page</div><ul class="VPDocOutlineItem root" data-v-05b516a5 data-v-f1c332fc><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-a3771c4a></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-761d60a5><div class="content-container" data-v-761d60a5><!--[--><!--]--><main class="main" data-v-761d60a5><div style="position:relative;" class="vp-doc _architecture_adr-001-crsqlite" data-v-761d60a5><div><h1 id="adr‐001-cr‐sqlite-local‐first-crdt" tabindex="-1">ADR‑001: CR‑SQLite (Local‑First + CRDT) <a class="header-anchor" href="#adr‐001-cr‐sqlite-local‐first-crdt" aria-label="Permalink to &quot;ADR‑001: CR‑SQLite (Local‑First + CRDT)&quot;">​</a></h1><ul><li><strong>Status:</strong> angenommen</li><li><strong>Datum:</strong> 2026‑01‑11</li></ul><h2 id="kontext" tabindex="-1">Kontext <a class="header-anchor" href="#kontext" aria-label="Permalink to &quot;Kontext&quot;">​</a></h2><p>FMB Log muss auf Netzlaufwerken funktionieren und mehrere Nutzer sollen parallel arbeiten können. Reines SQLite direkt auf SMB‑Shares ist dabei oft fehleranfällig (Dateisperren, Latenz, konkurrierende Writes). Ein klassischer DB‑Server (z. B. Postgres) ist in diesem Projekt bewusst nicht vorgesehen.</p><h2 id="entscheidung" tabindex="-1">Entscheidung <a class="header-anchor" href="#entscheidung" aria-label="Permalink to &quot;Entscheidung&quot;">​</a></h2><p>FMB Log nutzt <strong>CR‑SQLite</strong> (CRDT‑basierte Replikation als SQLite‑Extension), um ein <strong>Local‑First</strong> Modell umzusetzen:</p><ul><li>jeder Client schreibt in eine <strong>lokale Replica‑DB</strong> (AppLocalData),</li><li>ein optionaler <strong>Hub</strong> (Netzlaufwerk) dient als Austauschpunkt,</li><li>Clients synchronisieren Änderungen <strong>inkrementell</strong> (Pull/Push) über <code>crsql_changes</code>.</li></ul><p>Die Extension wird als Datei im Programm‑<code>resources/</code> gebündelt (Windows: <code>crsqlite.dll</code>) und vom SQL‑Layer geladen.</p><h2 id="alternativen-abgewogen" tabindex="-1">Alternativen (abgewogen) <a class="header-anchor" href="#alternativen-abgewogen" aria-label="Permalink to &quot;Alternativen (abgewogen)&quot;">​</a></h2><ol><li><strong>SQLite direkt auf Netzlaufwerk (Single‑File)</strong><ul><li><ul><li>sehr simpel</li></ul></li><li>− hohe Wahrscheinlichkeit für Locking-/SMB‑Probleme und Datenkorruption bei Fehlkonfiguration</li></ul></li><li><strong>DB‑Server (Postgres/MySQL)</strong><ul><li><ul><li>robuste Concurrency</li></ul></li><li>− Betrieb/Deployment/Firewall/Backups deutlich komplexer, widerspricht „kein Server“</li></ul></li><li><strong>Dokumenten‑DB ohne Server (z. B. LiteDB)</strong><ul><li><ul><li>keine SQL‑Migrations</li></ul></li><li>− Parallelzugriff/Locking auf Netzlaufwerken ebenfalls schwierig; weniger Integration in bestehende SQLite‑Logik</li></ul></li></ol><h2 id="konsequenzen" tabindex="-1">Konsequenzen <a class="header-anchor" href="#konsequenzen" aria-label="Permalink to &quot;Konsequenzen&quot;">​</a></h2><ul><li><strong>Schema‑Constraints (CRR‑Tauglichkeit):</strong><ul><li>Primary Keys müssen <strong>NOT NULL</strong> sein.</li><li><code>NOT NULL</code>‑Spalten benötigen <strong>DEFAULT</strong>‑Werte (Forward/Backward‑Compatibility).</li></ul></li><li><strong>IDs:</strong> keine Auto‑Increments als alleinige Schlüssel; stattdessen App‑seitig eindeutige IDs (z. B. <code>nanoid</code>).</li><li><strong>Migrations:</strong> Schemaänderungen erfolgen weiterhin über App‑Migrations; CR‑SQLite setzt dafür zusätzliche Regeln voraus.</li><li><strong>Fehlerklasse:</strong> Sync ist „eventual consistent“. Konflikte werden CRDT‑konform gelöst; dadurch sind bestimmte Datenmodelle (z. B. Zähler) leichter als harte Unique‑Constraints.</li><li><strong>Plattformabhängigkeit:</strong> Die CR‑SQLite Extension ist ein natives Binary pro Plattform.</li></ul><h2 id="hinweise-fur-betrieb-it" tabindex="-1">Hinweise für Betrieb/IT <a class="header-anchor" href="#hinweise-fur-betrieb-it" aria-label="Permalink to &quot;Hinweise für Betrieb/IT&quot;">​</a></h2><ul><li>Der Hub‑Ordner (Netzlaufwerk) muss für alle Clients <strong>lesbar/schreibbar</strong> sein.</li><li>Die lokale Replica‑DB muss pro Benutzer im AppLocalData Verzeichnis gespeichert werden (offline‑fähig).</li><li>Bei Diagnoseproblemen: zuerst prüfen, ob die Extension geladen wurde (<code>crsql_changes</code> verfügbar).</li></ul></div></div></main><footer class="VPDocFooter" data-v-761d60a5 data-v-34aa2812><!--[--><!--]--><div class="edit-info" data-v-34aa2812><!----><div class="last-updated" data-v-34aa2812><p class="VPLastUpdated" data-v-34aa2812 data-v-74a106e1>Last updated: <time datetime="2026-01-11T21:41:51.000Z" data-v-74a106e1></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-34aa2812><span class="visually-hidden" id="doc-footer-aria-label" data-v-34aa2812>Pager</span><div class="pager" data-v-34aa2812><a class="VPLink link pager-link prev" href="/architecture/" data-v-34aa2812><!--[--><span class="desc" data-v-34aa2812>Previous page</span><span class="title" data-v-34aa2812>Überblick</span><!--]--></a></div><div class="pager" data-v-34aa2812><a class="VPLink link pager-link next" href="/architecture/adr-002-integrity-signing.html" data-v-34aa2812><!--[--><span class="desc" data-v-34aa2812>Next page</span><span class="title" data-v-34aa2812>ADR‑002: Integrität & Signaturen</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-55287221 data-v-6a51cdf7><div class="container" data-v-6a51cdf7><p class="message" data-v-6a51cdf7>FMB Log – Dokumentation</p><p class="copyright" data-v-6a51cdf7>©EWN GmbH 2025, Martin Klemann</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"admin-guide_database.md\":\"CtA6Ndrd\",\"admin-guide_fgw.md\":\"BeE3gaLp\",\"admin-guide_groups-permissions.md\":\"Cs7tKaYt\",\"admin-guide_index.md\":\"BDwZ8JKR\",\"admin-guide_security.md\":\"CQL47oB6\",\"admin-guide_setup.md\":\"CHUqoK2e\",\"admin-guide_technical.md\":\"BHNaMv6Z\",\"admin-guide_troubleshooting.md\":\"CceiWtjg\",\"admin-guide_users-permissions.md\":\"49NR0tEg\",\"admin-guide_users.md\":\"F9-it1Hc\",\"architecture_adr-001-crsqlite.md\":\"DQ6cnhaB\",\"architecture_adr-002-integrity-signing.md\":\"a-BWvat9\",\"architecture_adr-003-protocol-packs.md\":\"BnD5XlJ0\",\"architecture_index.md\":\"DxViCOnF\",\"index.md\":\"nBQdKjeB\",\"reference_data-model.md\":\"BHGQEF_O\",\"reference_formulas.md\":\"Z47KS_Xh\",\"reference_index.md\":\"CS6dTvTn\",\"reference_permissions.md\":\"D4iWOIhP\",\"user-guide_account.md\":\"CaL4ydBW\",\"user-guide_containers.md\":\"CzEcYujo\",\"user-guide_data-quality.md\":\"DQ-vfyko\",\"user-guide_fmk.md\":\"Bb87l0uH\",\"user-guide_glossary.md\":\"Ce_Y68F6\",\"user-guide_import.md\":\"DOpq7mhj\",\"user-guide_index.md\":\"QwrN_I0p\",\"user-guide_nuclide-vectors.md\":\"Dlu649sj\",\"user-guide_quickstart.md\":\"gQCL6Ng8\",\"user-guide_reports.md\":\"PVQRFci5\",\"user-guide_search.md\":\"BekOI4Sz\",\"user-guide_settings.md\":\"DiwWzwbp\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"de-DE\",\"dir\":\"ltr\",\"title\":\"FMB Log\",\"description\":\"Benutzer- und Administratorhandbuch\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"User Guide\",\"link\":\"/user-guide/\"},{\"text\":\"Admin Guide\",\"link\":\"/admin-guide/\"},{\"text\":\"Referenz\",\"link\":\"/reference/\"},{\"text\":\"Architektur\",\"link\":\"/architecture/\"}],\"sidebar\":{\"/user-guide/\":[{\"text\":\"User Guide\",\"items\":[{\"text\":\"Überblick\",\"link\":\"/user-guide/\"},{\"text\":\"Schnellstart\",\"link\":\"/user-guide/quickstart\"},{\"text\":\"Suche & Deep-Links\",\"link\":\"/user-guide/search\"},{\"text\":\"Datenqualität\",\"link\":\"/user-guide/data-quality\"},{\"text\":\"Gebinde & Messungen\",\"link\":\"/user-guide/containers\"},{\"text\":\"Import (RPT / GS)\",\"link\":\"/user-guide/import\"},{\"text\":\"Nuklidvektoren (NV)\",\"link\":\"/user-guide/nuclide-vectors\"},{\"text\":\"FMK\",\"link\":\"/user-guide/fmk\"},{\"text\":\"Tagesabrechnung\",\"link\":\"/user-guide/reports\"},{\"text\":\"Einstellungen\",\"link\":\"/user-guide/settings\"},{\"text\":\"Konto & Passwort\",\"link\":\"/user-guide/account\"},{\"text\":\"Glossar\",\"link\":\"/user-guide/glossary\"}]}],\"/admin-guide/\":[{\"text\":\"Admin Guide\",\"items\":[{\"text\":\"Überblick\",\"link\":\"/admin-guide/\"},{\"text\":\"Ersteinrichtung\",\"link\":\"/admin-guide/setup\"},{\"text\":\"Sicherheitsarchitektur\",\"link\":\"/admin-guide/security\"},{\"text\":\"Benutzer\",\"link\":\"/admin-guide/users\"},{\"text\":\"Gruppen & Rechte\",\"link\":\"/admin-guide/groups-permissions\"},{\"text\":\"Freigabewerte (FGW)\",\"link\":\"/admin-guide/fgw\"},{\"text\":\"Betrieb & Datenbank\",\"link\":\"/admin-guide/database\"},{\"text\":\"Technische Doku\",\"link\":\"/admin-guide/technical\"},{\"text\":\"Troubleshooting\",\"link\":\"/admin-guide/troubleshooting\"}]}],\"/reference/\":[{\"text\":\"Referenz\",\"items\":[{\"text\":\"Überblick\",\"link\":\"/reference/\"},{\"text\":\"Rechte (Permission Keys)\",\"link\":\"/reference/permissions\"},{\"text\":\"Datenmodell\",\"link\":\"/reference/data-model\"},{\"text\":\"Rechner & Formeln\",\"link\":\"/reference/formulas\"}]}],\"/architecture/\":[{\"text\":\"Architektur\",\"items\":[{\"text\":\"Überblick\",\"link\":\"/architecture/\"},{\"text\":\"ADR‑001: CR‑SQLite\",\"link\":\"/architecture/adr-001-crsqlite\"},{\"text\":\"ADR‑002: Integrität & Signaturen\",\"link\":\"/architecture/adr-002-integrity-signing\"},{\"text\":\"ADR‑003: Protokoll‑Packfiles\",\"link\":\"/architecture/adr-003-protocol-packs\"}]}]},\"search\":{\"provider\":\"local\"},\"footer\":{\"message\":\"FMB Log – Dokumentation\",\"copyright\":\"©EWN GmbH 2025, Martin Klemann\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>