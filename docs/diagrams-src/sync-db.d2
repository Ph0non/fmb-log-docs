direction: down

style: {
  stroke: "#3d3e3d"
  stroke-width: 1
  font-size: 22
  border-radius: 8
}

title: "Sync‑Prozess (Replica ↔ Hub)" {
  near: top-center
  shape: text
  style.font-size: 26
  style.bold: true
}

step1: |md
  **1. Änderung in lokaler Replica**

  INSERT/UPDATE/DELETE
  ↓
  sofort lokal verfügbar
| {
  shape: rectangle
  style.fill: "#006e78"
  style.font-color: "#ffffff"
}

step2: |md
  **2. Sync wird ausgelöst**

  automatisch:
  • beim App‑Fokus
  • periodisch (~10 s)

  wenn Hub offline:
  • später erneut versuchen
| {
  shape: rectangle
  style.fill: "#f17119"
  style.font-color: "#ffffff"
}

step3: |md
  **3. Pull: Hub → Replica**

  neue Change‑Events
  anderer Sites holen
  (crsql_changes)
| {
  shape: rectangle
  style.fill: "#217ca3"
  style.font-color: "#ffffff"
}

step4: |md
  **4. Push: Replica → Hub**

  eigene Change‑Events
  in Hub schreiben
  (crsql_changes)
| {
  shape: rectangle
  style.fill: "#63a90f"
  style.font-color: "#ffffff"
}

step5: |md
  **5. Konvergenz (eventual consistency)**

  alle Clients konvergieren
  deterministisch auf
  denselben Stand
| {
  shape: rectangle
  style.fill: "#e4e1d2"
  style.font-color: "#3d3e3d"
}

step1 -> step2: Trigger
step2 -> step3
step3 -> step4
step4 -> step5

note: "Konflikte werden deterministisch gelöst\n(z. B. Last‑Write‑Wins auf Zellenebene; Delete dominiert)." {
  shape: text
  near: bottom-center
  style.font-size: 16
  style.italic: true
}
